/*! DO NOT EDIT THIS FILE */
/*! File Minified by grunt @ 2015-10-20 11:53 */
/*!
 * DO NOT EDIT THIS FILE
 * File concatatenated by grunt @ 2015-10-20 11:53
 * HeadStart
 * 
 * 
 * @author Nic Mulvaney
 * @version 0.0.1
 * Copyright 2013. MIT licensed.
 */


var App=App||{},scripts=[{jquery:"js/vendor/jquery-2.1.4.min.js"},{localforage:"js/vendor/localforage.min.js"}],event_down,event_move,event_release,transition="transitionend webkitTransitionEnd",animation="animationend webkitAnimationEnd";App.view=function(){var search,allResults,items,history,_history,init=function(){console.log("All ready!"),getHistory(),search=$("#search"),results=$("#results"),sentence=$("#sentence"),article=$("#article"),history=$(".history"),actions()},actions=function(){search.on("input",function(){var val=search.val();if(""===val)return results.html(""),void sentence.html("");var data={action:"opensearch",limit:5,search:val};App.api.get("wiki",data,function(results){allResults=results,showResults()})}),$(window).on("keydown",function(e){40===e.keyCode&&(items.filter(".active").next().trigger(event_down),e.preventDefault(),e.stopPropagation()),38===e.keyCode&&(items.filter(".active").prev().trigger(event_down),e.preventDefault(),e.stopPropagation()),13===e.keyCode&&(showArticle(),e.preventDefault(),e.stopPropagation())}),history.on(event_release,function(e){toggleHistory(),search.focus(),e.preventDefault()}),search.focus()},showArticle=function(){var id=items.filter(".active").data().id;_history[1].unshift(allResults[1][id]),_history[2].unshift(allResults[2][id]),_history[3].unshift(allResults[3][id]),saveHistory(),window.open(allResults[3][id])},showResults=function(){var html="";$(allResults[1]).each(function(i,a){html+="<div class='item' data-id='"+i+"'>"+a+"</div>"}),sentence.html(""),results.html(html),items=results.find(".item"),items.on(event_down,function(){if($(this).hasClass("active"))return void showArticle();items.removeClass("active"),$(this).addClass("active");var id=$(this).data().id,link=allResults[3][id];sentence.html(allResults[2][id]+"<br/><a href='"+link+"'>"+link+"<a/> â†µ")}).eq(0).trigger(event_down)},getHistory=function(){localforage.getItem("wikiHasHistory",function(err,result){null===result&&(result=!0),history.text(result?"disable history":"enable history"),result?localforage.getItem("wikiHistory",function(err,result){_history=result,_history instanceof Array&&(_history.length||(_history=null)),_history||(_history=["HISTORY",[],[],[]]),allResults=_history,showResults()}):(_history=["HISTORY",[],[],[]],saveHistory(),sentence.html(""),results.html(""))})},saveHistory=function(){_history[1]=_history[1].slice(0,5),_history[2]=_history[2].slice(0,5),_history[3]=_history[3].slice(0,5),localforage.setItem("wikiHistory",_history,function(){})},toggleHistory=function(){localforage.getItem("wikiHasHistory",function(err,result){result||(result=!1),localforage.setItem("wikiHasHistory",!result,function(){getHistory()})})};return{init:init}}(),App.api=function(){var xhr,urls={wiki:"https://en.wikipedia.org/w/api.php"},get=function(type,data,success,error){var url=urls[type];xhr=$.ajax({url:url,data:data,dataType:"jsonp",type:"GET",contentType:"application/json",cache:!1,timeout:15e3,success:function(data){success&&success(data)},error:function(data){"timeout"===data.statusText?console.log("Connection timed out."):"abort"!==data.statusText&&console.log("Connection error!"),error&&error(data)}})},abort=function(){xhr&&4!==xhr.readyState&&xhr.abort()};return{get:get,abort:abort}}();var ready=function(){head.js.apply(window,scripts).ready("localforage",function(){App.view.init()})};window.cordova?document.addEventListener("deviceready",ready,!1):ready(),window.console=window.console||{log:function(){}},event_down="mousedown",event_move="mousemove",event_release="mouseup";